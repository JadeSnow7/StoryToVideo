# 需求文档（飞书交付稿）

## 1. 背景与目标
- **产品定位**：StoryToVideo，面向需要快速将文本创意转化为可播放视频的创作者。
- **MVP 目标**：19 天内跑通“故事输入→分镜→生成→预览导出”的端到端链路，覆盖基础交互和异常处理。
- **成功标准**：支持 3 个以上风格预设，完成分镜生成、图片/视频生成、音频旁白、预览播放与 MP4 导出；UI 60fps、长任务不中断 UI 线程。

## 2. 用户与场景
- **核心用户**：短内容创作者、视频剪辑初学者、产品/市场需要快速做 Demo 的人员。
- **典型场景**：
  - 输入一段 300~500 字的故事，自动生成分镜卡片并快速预览。
  - 轻量编辑分镜的 Prompt/旁白，重新生成图片或视频片段。
  - 批量生成所有分镜后，一键合成并导出 MP4。

## 3. 业务范围与功能列表（MVP）
1) **F1 新建故事**：输入文本、选择风格（电影 / 二次元 / 写实等），点击生成调用 LLM 获取分镜与旁白。
2) **F2 分镜列表**：以横向时间轴展示分镜卡片（缩略图、序号、描述、状态标签），支持进入详情。
3) **F3 分镜详情**：可编辑 Prompt 与旁白，触发 SD Turbo 生成图片；状态流转 PENDING→RUNNING→SUCCESS/FAILED，可重试。
4) **F4 视频预览与导出**：按顺序播放片段，支持音量/进度控制；调用合成流水线导出 MP4，成功弹 Toast。
5) **F5 素材资产页**：历史项目网格，按标题/时间过滤；hover 显示“打开/删除”，支持新建跳转。

## 4. 非功能需求
- **性能**：UI 60fps；网络请求与任务查询全部异步；长耗时通过 WebSocket 推送+轮询兜底。
- **可靠性**：任务队列支持超时、重试、失败原因透出；断线后可重新获取状态。
- **存储**：SQLite+本地文件缓存（客户端），PostgreSQL + OSS（云端）；离线可读已生成内容。
- **安全**：令牌鉴权；接口限流与日志；OSS 资源通过带签名 URL 分发。

## 5. 数据模型（摘要）
- **Project**(id, title, style, created_at)
- **Shot**(id, project_id, order, prompt, narration, image_url, video_url, status)
- **Task**(id, type, payload, status, result_data, err_msg)

## 6. 验收与度量
- **功能验收**：
  - 完成分镜生成与编辑，所有分镜可生成图片；可选视频片段生成正常。
  - Preview 页可顺序播放所有片段，导出 MP4 成功率 ≥ 95%。
- **体验度量**：
  - 首次分镜生成 ≤ 15s（含网络）；图片生成单次 ≤ 8s（GPU 视配置）。
  - UI 操作无明显卡顿，主要交互控制在 100ms 内响应。
- **上线要求**：11.30 前实现链路跑通，12.05 完成本地算力联通、文档与录屏。
