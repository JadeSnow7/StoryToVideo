# ğŸ“½ï¸ æ•…äº‹åˆ°è§†é¢‘ç”Ÿæˆå™¨ (Story-to-Video Generator)

è¿™æ˜¯ä¸€ä¸ªåŸºäº Qt C++ å’Œ QML çš„ç»ƒæ‰‹é¡¹ç›®ï¼Œæ—¨åœ¨å®ç°ä¸€ä¸ªå®Œæ•´çš„â€œæ•…äº‹åˆ°è§†é¢‘â€å†…å®¹ç”Ÿæˆé“¾è·¯ã€‚é¡¹ç›®é€šè¿‡ LLMï¼ˆOllamaï¼‰ç”Ÿæˆåˆ†é•œæè¿°ï¼Œé€šè¿‡ Stable Diffusion (SD Turbo) ç”Ÿæˆå…³é”®å¸§å›¾åƒï¼Œå¹¶æœ€ç»ˆåˆæˆè§†é¢‘ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½ä¸æŠ€æœ¯æ ˆ

æœ¬é¡¹ç›®å…¼å®¹ **Qt 5.8 / MinGW 32-bit** ç¯å¢ƒï¼Œå¹¶å®ç°äº†ä¸å¤–éƒ¨ AI æœåŠ¡çš„å¼‚æ­¥é€šä¿¡ã€‚

| æ¨¡å— | æŠ€æœ¯æ ˆ / API | çŠ¶æ€ | èŒè´£ |
| :--- | :--- | :--- | :--- |
| **å‰ç«¯ UI** | Qt QML (å…¼å®¹ 5.8 / Controls 2.1) | âœ… å®Œæˆ | æä¾›äº”å¤§é¡µé¢å’Œäº¤äº’é€»è¾‘ã€‚ |
| **LLM é›†æˆ** | C++ Qt Network / Ollama (Qwen2.5) | âœ… å®Œæˆ | å¼‚æ­¥è°ƒç”¨ LLM APIï¼Œç”Ÿæˆå¹¶è§£ææµå¼ JSON åˆ†é•œã€‚ |
| **å›¾åƒç”Ÿæˆ** | C++ Qt Network / SD Turbo (REST API) | âœ… å®Œæˆ | Base64 è§£ç å¹¶ä¿å­˜å…³é”®å¸§å›¾åƒåˆ°æœ¬åœ°ã€‚ |
| **æ ¸å¿ƒé€»è¾‘** | C++ ViewModel | âœ… å®Œæˆ | ç»Ÿä¸€çŠ¶æ€ç®¡ç†ã€QML/C++ åŒå‘é€šä¿¡ã€‚ |
| **è§†é¢‘å¤„ç†** | FFmpeg / OpenGL | â³ å¾…å®ç° | è´Ÿè´£æœ€ç»ˆçš„è§†é¢‘åˆæˆå’Œè½¬åœºæ•ˆæœã€‚ |

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„åˆ†å±‚

é¡¹ç›®é‡‡ç”¨æ ‡å‡†çš„ Qt C++/QML æ¶æ„ï¼Œç¡®ä¿å‰åç«¯åˆ†ç¦»ï¼š

### I. C++ åç«¯å±‚ (Business Logic)

| æ–‡ä»¶å | èŒè´£è¯´æ˜ | å…³é”®åŠŸèƒ½ |
| :--- | :--- | :--- |
| `ViewModel.h/cpp` | **çŠ¶æ€ä¸é€»è¾‘æ ¸å¿ƒã€‚** | æš´éœ²ä¾› QML è°ƒç”¨çš„å‡½æ•° (`Q_INVOKABLE`)ï¼›è§£æ LLM JSONï¼›åè°ƒç½‘ç»œè¯·æ±‚ã€‚ |
| `NetworkManager.h/cpp`| **ç½‘ç»œé€šä¿¡å±‚ã€‚** | å°è£… Ollama å’Œ Stable Diffusion çš„ API è¯·æ±‚ï¼Œå¤„ç†å¼‚æ­¥å›å¤å’Œé”™è¯¯è½¬å‘ã€‚ |
| `main.cpp` | **ç¨‹åºå…¥å£ã€‚** | å¯åŠ¨ QML å¼•æ“ï¼›å®ä¾‹åŒ–å¹¶æš´éœ² `viewModel` å¯¹è±¡ã€‚ |

### II. QML å‰ç«¯å±‚ (User Interface)

æ‰€æœ‰ QML æ–‡ä»¶ä½äº `/qml` ç›®å½•ä¸‹ï¼Œé€šè¿‡ `StackView` ç®¡ç†å¯¼èˆªã€‚

| é¡µé¢æ–‡ä»¶ | èŒè´£è¯´æ˜ |
| :--- | :--- |
| `main.qml` | å¯åŠ¨ä¸å¯¼èˆªæ¡†æ¶ (`StackView`)ã€‚ |
| `CreatePage.qml` | æ•…äº‹æ–‡æœ¬è¾“å…¥ï¼Œè°ƒç”¨ LLM ç”Ÿæˆåˆ†é•œã€‚ |
| `StoryboardPage.qml` | å±•ç¤º LLM åˆ†é•œç»“æœï¼Œå¹¶æä¾›ã€ä¸€é”®ç”Ÿæˆè§†é¢‘ã€‘å…¥å£ã€‚ |
| `ShotDetailPage.qml` | ç¼–è¾‘å•ä¸ªåˆ†é•œçš„ Prompt/Narrationï¼Œå¹¶è§¦å‘ SD å›¾åƒç”Ÿæˆã€‚ |
| `AssetsPage.qml` | èµ„äº§åº“å’Œé¡¹ç›®åˆ—è¡¨ã€‚ |
| `PreviewPage.qml` | è§†é¢‘é¢„è§ˆå’Œå¯¼å‡ºåŠŸèƒ½ã€‚ |

---

## âœ… å½“å‰å¼€å‘çŠ¶æ€ä¸æˆå°±

å½“å‰ä»£ç åº“å·²å®ç°ä»¥ä¸‹å…³é”®é“¾è·¯ï¼š

1.  **QML â†” C++ é€šä¿¡é“¾è·¯å®Œæ•´ï¼š** QML å¯ä»¥è°ƒç”¨ C++ å‡½æ•°ï¼ŒC++ å¯ä»¥é€šè¿‡ä¿¡å·è¿”å›æ•°æ®å’ŒçŠ¶æ€ã€‚
2.  **LLM åˆ†é•œç”ŸæˆæˆåŠŸï¼š** æˆåŠŸè§£å†³äº† Ollama **æ¨¡å‹åç§°**å’Œ **æµå¼ JSON è§£æ**éš¾é¢˜ï¼Œç¨‹åºèƒ½ç¨³å®šè·å– LLM è¿”å›çš„ 5 ä¸ªåˆ†é•œæ•°æ®ã€‚
3.  **åˆ†é•œæ•°æ®ç»‘å®šï¼š** LLM ç”Ÿæˆçš„åˆ†é•œæ•°æ®æˆåŠŸä¼ é€’å¹¶ç»‘å®šåˆ° `StoryboardPage`ï¼Œå®ç°äº†åˆ—è¡¨å±•ç¤ºã€‚
4.  **å›¾åƒç”Ÿæˆé“¾è·¯å°±ç»ªï¼š** `ShotDetailPage` å¯è°ƒç”¨ C++ å‘ SD API å‘é€è¯·æ±‚ï¼ŒC++ ç«¯å·²é›†æˆ **Base64 è§£ç **å’Œ**æœ¬åœ°æ–‡ä»¶ä¿å­˜**é€»è¾‘ã€‚

### å¾…åŠäº‹é¡¹ (TODOs)

1.  **å¯åŠ¨ SD API æœåŠ¡ï¼š** å¿…é¡»æ‰‹åŠ¨å¯åŠ¨ Stable Diffusion API æœåŠ¡ï¼ˆå¦‚ Python Flask/FastAPI ç›‘å¬ `http://localhost:5000`ï¼‰ï¼Œå¦åˆ™å›¾åƒç”Ÿæˆå°†è¿”å› **"è¿æ¥è¢«æ‹’ç»"** é”™è¯¯ã€‚
2.  **è§†é¢‘åˆæˆï¼š** å®ç° `VideoProcessor` ç±»ï¼Œé›†æˆ FFmpeg åº“ï¼Œå®Œæˆè§†é¢‘åˆæˆå’Œè½¬åœºé€»è¾‘ã€‚
3.  **æ•°æ®æŒä¹…åŒ–ï¼š** é›†æˆ SQLiteï¼Œå®ç°é¡¹ç›®æ•°æ®çš„ç¦»çº¿å­˜å‚¨ã€‚
4.  **ä¿®å¤è§†é¢‘é¢„è§ˆï¼š** è§£å†³ Qt Multimedia æ’ä»¶ç¼ºå¤±é—®é¢˜ï¼Œä»¥å¯ç”¨ `Video` å…ƒç´ ã€‚

---

## ğŸ åœ¨ macOS ä¸Šæ‰“åŒ…å®¢æˆ·ç«¯

> éœ€è¦åœ¨å®‰è£…äº† Xcode Command Line Tools ä¸ Homebrew çš„ macOS ç¯å¢ƒæ‰§è¡Œã€‚

1.  å®‰è£…ä¾èµ–ï¼ˆQt å’Œ Ninjaï¼‰ï¼š

    ```bash
    brew install qt ninja
    ```

2.  è¿è¡Œæ‰“åŒ…è„šæœ¬ï¼ˆé»˜è®¤è¾“å‡ºåˆ° `build-macos/install`ï¼‰ï¼š

    ```bash
    ./scripts/package_mac_client.sh
    ```

    - ç”Ÿæˆçš„ `StoryToVideo.app` ä¼šæ”¾åœ¨ `build-macos/install/` ç›®å½•ã€‚
    - åŒç›®å½•ä¼šäº§å‡ºå¯åˆ†å‘çš„ `StoryToVideo-macOS.dmg`ã€‚

3.  å¦‚æœ Qt éé€šè¿‡ Homebrew å®‰è£…ï¼Œå¯æ‰‹åŠ¨æŒ‡å®šè·¯å¾„ï¼š

    ```bash
    QT_PREFIX=/path/to/Qt ./scripts/package_mac_client.sh
    ```