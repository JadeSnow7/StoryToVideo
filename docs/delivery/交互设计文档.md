# 交互设计文档（飞书交付稿）

## 1. 信息架构与导航
- **入口流**：Splash/Login → 资产首页 → 新建故事 → 分镜列表 → 分镜详情 → 预览导出，全链路以单向流转避免迷路。
- **页面角色**：
  - 资产首页：历史项目网格，支持筛选/搜索，提供“新建”入口与最近使用提示。
  - 新建故事：左侧文本输入 + 风格预设选择；右侧生成结果摘要；生成中按钮禁用并显示进度与剩余时间。
  - 分镜列表：底部横向时间轴，卡片包含缩略图/序号/描述/状态；顶部 Action Bar 支持“生成全部”“合成预览”，保持就近操作。
  - 分镜详情：左图右表单，支持 Prompt、旁白编辑与重生；状态遮罩指示生成中；失败显示原因与重试按钮并允许复制报错。
  - 预览导出：标准播放器控件（播放/暂停、进度、音量、全屏）；导出 MP4 弹窗选择路径，完成后 Toast 与文件定位入口。

> 【图示占位】信息架构流程图/站点地图。

## 2. 关键交互流程
1) **新建故事**
   - 输入文本 ≤500 字，选择风格 → 点击“生成分镜” → 按钮 loading + 禁用，底部展示预计耗时。
   - LLM 返回分镜列表，展示生成状态；失败弹出错误提示并保留输入，以便修改后重试。
2) **分镜生成与编辑**
   - 在分镜列表中点击卡片或双击进入详情；当前卡片高亮，时间轴可左右滚动并吸附到当前镜头。
   - 详情页编辑 Prompt/旁白后点击“生成图片”，状态切换为 RUNNING，显示进度遮罩；成功展示新缩略图，失败展示原因并提供“重新生成”与日志复制。
   - 支持批量“生成全部”，在 Action Bar 上触发，逐个更新状态并显示整体进度。
3) **预览与导出**
   - 点击“合成预览”，调用后端拼接片段；生成中展示进度条并禁止重复提交，失败提供“仅刷新失败片段”选项。
   - 预览播放器支持键盘空格播放/暂停、左右键快进/快退 5 秒。
   - 导出 MP4 打开文件对话框，确认后后台合成并弹出 Toast；失败时 Toast 显示错误并可重试或改为低码率导出。

> 【图示占位】核心流程时序图（新建故事、生成分镜、预览导出）。

## 3. 组件与状态
- **通用状态枚举**：PENDING / RUNNING / SUCCESS / FAILED，所有卡片与按钮以颜色和标签呈现。
- **反馈规范**：
  - 操作成功：Toast（3s 自动消失），必要时附带“查看文件”快捷入口。
  - 操作失败：Toast + 详情弹窗（含错误码、重试按钮），保留上下文并允许复制错误。
  - 长耗时：按钮 loading、遮罩、进度条；网络异常自动重连提示并展示最后一次同步时间。
- **空态与占位**：
  - 新建故事：无记录时显示插画和“去新建”按钮。
  - 分镜详情：未生成图片时使用灰底占位；生成中显示模糊遮罩。

> 【图示占位】组件状态示例（卡片状态、表单校验、空态）。

## 4. 可用性与可访问性
- 支持键盘 Tab 焦点导航，提供快捷键（空格播放/暂停、Ctrl+Enter 生成、Delete 删除资产）。
- 重要按钮具备二次确认（删除资产、放弃编辑）。
- 颜色对比度遵循暗色主题规范（背景 #1E1E1E，主色 #3B82F6，文本 #FFFFFF/#9CA3AF）。

> 【图示占位】快捷键与可访问性标注示意。

## 5. 原型与交互细节（摘要）
- **时间轴交互**：卡片 hover 提示状态与操作，选中时加粗描边；滚动惯性与吸附。
- **表单校验**：故事文本为空或超长时禁用生成按钮；Prompt 为空时生成按钮提示“请输入 Prompt”。
- **错误兜底**：WebSocket 断开后自动退回轮询，直到任务完成或超时；所有错误面板提供“复制错误信息”。

> 【图示占位】关键界面原型（时间轴、分镜详情、导出弹窗）。
